(function($){$.fn.setCursorPosition=function(pos){this.each(function(index,elem){if(elem.setSelectionRange){elem.setSelectionRange(pos,pos)}else if(elem.createTextRange){var range=elem.createTextRange();range.collapse(true);range.moveEnd("character",pos);range.moveStart("character",pos);range.select()}});return this};$.fn.getCursorPosition=function(){var input=this.get(0);if(!input)return;if("selectionStart"in input){return input.selectionStart}else if(document.selection){input.focus();var sel=document.selection.createRange();var selLen=document.selection.createRange().text.length;sel.moveStart("character",-input.value.length);return sel.text.length-selLen}};$.fn.getCursorRange=function(){var input=this.get(0);if(!input)return;if("selectionStart"in input){return{s:input.selectionStart,l:input.selectionEnd-input.selectionStart}}else if(document.selection){}};jQuery.fn.highlight=function(duration,class_name,onComplete,delay){var defaults={delay:1500,duration:1e3};delay=delay==undefined?defaults.delay:delay;duration=duration||defaults.duration;var easing="out";$(this).each(function(){var el=$(this);var el_position_changed=false;if(el.data("highlighted"))return;var start_css={position:"absolute",left:0,top:0,width:"100%",height:"100%","background-color":"#FFF3B8",opacity:".6","z-index":"90","pointer-events":"none"};var end_css={opacity:0};function onTransitionComplete(){$(this).remove();el.data("highlighted",false);if(el_position_changed)el.css("position","static");if(onComplete)onComplete()}el.data("highlighted",true);if(el.css("position")=="static"){el.css("position","relative");el_position_changed=true}$('<div class="'+class_name+'" />').css(start_css).appendTo(el).delay(delay).transition(end_css,duration,easing,onTransitionComplete)})},jQuery.fn.highlightText=function(duration,class_name,onComplete,delay){delay=delay==undefined?2e3:delay;$(this).each(function(){var el=$(this);var el_original_bg=$(this).css("background-color");if(el.data("highlighted"))return;el.data("highlighted",true);el.css({"background-color":"#FFF3B8",transition:"background-color 0.25s"}).delay(delay).queue(function(){el.css({"background-color":el_original_bg});el.data("highlighted",false);if(onComplete)onComplete()})})},jQuery.fn.hideWithRememberedScrollTop=function(){$(this).each(function(){var el=$(this);if(el.hasClass("hidden"))return;el.data("remembered_scrolltop",el.scrollTop());var scrollers=el.find(":scrollable()");scrollers.each(function(index,desc){var $desc=$(desc);$desc.data("remembered_scrolltop",$desc.scrollTop())});el.addClass("hidden")})};jQuery.fn.unhideWithRememberedScrollTop=function(){$(this).each(function(){var el=$(this);if(!el.hasClass("hidden"))return;el.removeClass("hidden");var remembered_scrolltop=el.data("remembered_scrolltop");if(remembered_scrolltop!=undefined){el.scrollTop(remembered_scrolltop)}var scrollers=el.find(":scrollable()");if(scrollers){scrollers.each(function(index,desc){var $desc=$(desc);remembered_scrolltop=$desc.data("remembered_scrolltop");if(remembered_scrolltop!=undefined){$desc.scrollTop(remembered_scrolltop)}})}})}})(jQuery);(function($){if(!$){return}$.fn.headroom=function(option){return this.each(function(){var $this=$(this),data=$this.data("headroom"),options=typeof option==="object"&&option;options=$.extend(true,{},Headroom.options,options);if(!data){data=new Headroom(this,options);data.init();$this.data("headroom",data)}if(typeof option==="string"){data[option]()}})};$("[data-headroom]").each(function(){var $this=$(this);$this.headroom($this.data())})})(window.Zepto||window.jQuery);(function($){$.event.special.textchange={setup:function(data,namespaces){$(this).data("textchange_lastvalue",this.contentEditable==="true"?$(this).html():$(this).val());$(this).bind("keyup.textchange",$.event.special.textchange.handler);if(data&&data.sync){$(this).bind("cut.textchange paste.textchange input.textchange",$.event.special.textchange.handler)}else{$(this).bind("cut.textchange paste.textchange input.textchange",$.event.special.textchange.delayedHandler)}},teardown:function(namespaces){$(this).unbind(".textchange")},handler:function(event){$.event.special.textchange.triggerIfChanged($(this))},delayedHandler:function(event){var element=$(this);if(!$.event.special.textchange.timer){$.event.special.textchange.timer=setTimeout(function(){$.event.special.textchange.timer=null;$.event.special.textchange.triggerIfChanged(element)},250)}},triggerIfChanged:function(element){var current=element[0].contentEditable==="true"?element.html():element.val();if(current!==element.data("textchange_lastvalue")){element.trigger("textchange",[element.data("textchange_lastvalue")]);element.data("textchange_lastvalue",current)}},timer:null};$.event.special.hastext={setup:function(data,namespaces){$(this).bind("textchange",$.event.special.hastext.handler)},teardown:function(namespaces){$(this).unbind("textchange",$.event.special.hastext.handler)},handler:function(event,textchange_lastvalue){if(textchange_lastvalue===""&&textchange_lastvalue!==$(this).val()){$(this).trigger("hastext")}}};$.event.special.notext={setup:function(data,namespaces){$(this).bind("textchange",$.event.special.notext.handler)},teardown:function(namespaces){$(this).unbind("textchange",$.event.special.notext.handler)},handler:function(event,textchange_lastvalue){if($(this).val()===""&&$(this).val()!==textchange_lastvalue){$(this).trigger("notext")}}}})(jQuery);(function($){$.fn.autogrow=function(options){return this.filter("textarea").each(function(){var self=this;var $self=$(self);var minHeight=$self.height();var noFlickerPad=$self.hasClass("autogrow-short")?0:parseInt($self.css("lineHeight"))||0;var shadow=$("<div></div>").css({position:"absolute",top:-1e4,left:-1e4,width:$self.width(),fontSize:$self.css("fontSize"),fontFamily:$self.css("fontFamily"),fontWeight:$self.css("fontWeight"),lineHeight:$self.css("lineHeight"),resize:"none","word-wrap":"break-word"}).appendTo(document.body);var update=function(event){var times=function(string,number){for(var i=0,r="";i<number;i++)r+=string;return r};var val=self.value.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/\n$/,"<br/>&nbsp;").replace(/\n/g,"<br/>").replace(/ {2,}/g,function(space){return times("&nbsp;",space.length-1)+" "});if(event&&event.data&&event.data.event==="keydown"&&event.keyCode===13){val+="<br />"}var was_h=$self.height();shadow.css("width",$self.width());shadow.html(val+(noFlickerPad===0?"...":""));$self.height(Math.max(shadow.height()+noFlickerPad,minHeight));var cp=$self.getCursorPosition();var tl=$self.val().length;if(tl-cp<10){if($self.length&&document.activeElement==$self[0]){var parent_scroller=$self.closest(".flex_content_scroller");var parent_modal=$self.closest(".modal");if(parent_scroller.length){var $el_to_keep_in_view=$self;if($self.data("el-id-to-keep-in-view")){$el_to_keep_in_view=$("#"+$self.data("el-id-to-keep-in-view"));if(!$el_to_keep_in_view.length)$el_to_keep_in_view=$self}if(!TS.client.ui.isElInView($el_to_keep_in_view,-50,parent_scroller.dimensions_rect())){$el_to_keep_in_view.scrollintoview({offset:"bottom",px_offset:-50,duration:200})}if($self.height()!=was_h){TS.ui.utility.updateClosestMonkeyScroller(parent_scroller)}}else if(parent_modal.length==-1){$self.scrollintoview({offset:"bottom",px_offset:-50,duration:200})}}}};$self.change(update).keyup(update).keydown({event:"keydown"},update);$(window).on("resize",update);$self.one("remove",function(){$(window).off("resize",update)});update()})}})(jQuery);(function($){$.event.special.destroyed={remove:function(o){if(o.handler){o.handler()}}}})(jQuery);
